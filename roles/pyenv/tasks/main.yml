- import_tasks: debian.yml
  when: ansible_os_family == "Debian"

- import_tasks: arch.yml
  when: ansible_os_family == "Archlinux"

- name: Install pyenv-update
  git:
    repo: https://github.com/pyenv/pyenv-update
    dest: ~/.pyenv/plugins/pyenv-update

- name: Install Python versions with pyenv
  shell: "{{ user_home }}/.pyenv/bin/pyenv install {{ item }} --skip-existing"
  args:
    creates: "{{ '~/.pyenv/versions/' + item | expanduser }}"
  loop: "{{ pyenv_global_versions }}"
  when: ansible_os_family == "Debian"

- name: Install Python versions with pyenv
  shell: "pyenv install {{ item }} --skip-existing"
  args:
    creates: "{{ '~/.pyenv/versions/' + item | expanduser }}"
  loop: "{{ pyenv_global_versions }}"
  when: ansible_os_family == "Archlinux"

- name: Check if python exists
  command: which python
  register: python_check
  failed_when: python_check.rc > 1
  changed_when: python_check.rc == 1

- name: Create python symlink
  file:
    src: /usr/bin/python3
    dest: /usr/bin/python
    state: link
  become: yes
  when: python_check.rc == 1
